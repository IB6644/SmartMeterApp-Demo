<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CEM6 èª¤çµç·šæ¤œå‡ºã‚¢ãƒ—ãƒª - ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒ‡ãƒ¢</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica', 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            overflow-x: hidden;
        }

        .demo-header {
            text-align: center;
            color: white;
            margin-bottom: 20px;
            width: 100%;
            max-width: 1200px;
        }

        .demo-header h1 {
            font-size: 28px;
            margin-bottom: 8px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .demo-header p {
            font-size: 14px;
            opacity: 0.9;
        }

        .device-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            background: rgba(255,255,255,0.2);
            padding: 10px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }

        .device-selector button {
            padding: 10px 20px;
            border: 2px solid white;
            background: transparent;
            color: white;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .device-selector button.active {
            background: white;
            color: #667eea;
        }

        .device-selector button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .emulator-container {
            background: #1a1a1a;
            border-radius: 30px;
            padding: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            transition: all 0.3s ease;
        }

        .emulator-container.phone {
            width: 405px;
        }

        .emulator-container.tablet {
            width: 810px;
        }

        .device-frame {
            background: black;
            border-radius: 20px;
            overflow: hidden;
            position: relative;
        }

        .device-frame.phone {
            width: 375px;
            height: 667px;
        }

        .device-frame.tablet {
            width: 768px;
            height: 1024px;
        }

        .status-bar {
            height: 24px;
            background: #000;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 15px;
            font-size: 11px;
            color: white;
        }

        .status-bar-left {
            display: flex;
            gap: 8px;
        }

        .status-bar-right {
            display: flex;
            gap: 5px;
            align-items: center;
        }

        .app-screen {
            height: calc(100% - 24px);
            background: #f5f5f5;
            overflow-y: auto;
            position: relative;
        }

        .screen {
            display: none;
            flex-direction: column;
            height: 100%;
        }

        .screen.active {
            display: flex;
        }

        .header {
            background: #aa0000;
            color: white;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .header h2 {
            font-size: 18px;
            font-weight: 600;
        }

        .help-btn {
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            padding: 5px;
        }

        .content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        .welcome-section {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .welcome-section h3 {
            color: #aa0000;
            margin-bottom: 10px;
            font-size: 20px;
        }

        .welcome-section p {
            color: #666;
            line-height: 1.6;
        }

        .feature-card {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .feature-card:active {
            transform: scale(0.98);
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }

        .feature-icon {
            width: 50px;
            height: 50px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin-right: 15px;
        }

        .feature-text {
            flex: 1;
        }

        .feature-text h4 {
            font-size: 16px;
            margin-bottom: 4px;
            color: #333;
        }

        .feature-text p {
            font-size: 13px;
            color: #666;
        }

        .chevron {
            color: #999;
            font-size: 20px;
        }

        .connection-status {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #ccc;
        }

        .status-indicator.connected {
            background: #4caf50;
            box-shadow: 0 0 10px rgba(76,175,80,0.5);
        }

        .status-indicator.connecting {
            background: #ff9800;
            animation: pulse 1.5s infinite;
        }

        .status-indicator.error {
            background: #f44336;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .status-text {
            flex: 1;
        }

        .status-text h4 {
            font-size: 14px;
            margin-bottom: 2px;
        }

        .status-text p {
            font-size: 12px;
            color: #666;
        }

        .action-button {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-bottom: 10px;
        }

        .action-button.primary {
            background: #aa0000;
            color: white;
        }

        .action-button.secondary {
            background: #2196f3;
            color: white;
        }

        .action-button.success {
            background: #4caf50;
            color: white;
        }

        .action-button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .action-button:active:not(:disabled) {
            transform: scale(0.98);
        }

        .data-grid {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 15px;
        }

        .data-grid-header {
            background: #f0f0f0;
            padding: 12px 15px;
            font-weight: 600;
            font-size: 14px;
            border-bottom: 1px solid #ddd;
        }

        .data-grid-row {
            display: flex;
            padding: 12px 15px;
            border-bottom: 1px solid #f0f0f0;
        }

        .data-grid-row:last-child {
            border-bottom: none;
        }

        .data-grid-label {
            flex: 1;
            font-size: 13px;
            color: #666;
        }

        .data-grid-value {
            flex: 1;
            font-size: 13px;
            color: #333;
            font-weight: 500;
            text-align: right;
        }

        .info-section {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #2196f3;
        }

        .info-section h4 {
            color: #1976d2;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .info-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 8px;
            gap: 8px;
        }

        .info-item:last-child {
            margin-bottom: 0;
        }

        .info-item-icon {
            color: #4caf50;
            font-size: 16px;
            margin-top: 2px;
        }

        .info-item p {
            font-size: 13px;
            color: #555;
            line-height: 1.5;
        }

        .form-group {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            font-size: 13px;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }

        .form-group select,
        .form-group input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
        }

        .timer-display {
            background: white;
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 15px;
        }

        .timer-display h3 {
            font-size: 48px;
            color: #aa0000;
            font-weight: 700;
            font-family: 'Courier New', monospace;
        }

        .timer-display p {
            font-size: 14px;
            color: #666;
            margin-top: 10px;
        }

        .alert-box {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            margin: 20px;
        }

        .alert-box h3 {
            font-size: 18px;
            margin-bottom: 10px;
            color: #333;
        }

        .alert-box p {
            font-size: 14px;
            color: #666;
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .alert-buttons {
            display: flex;
            gap: 10px;
        }

        .alert-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
        }

        .alert-btn.primary {
            background: #aa0000;
            color: white;
        }

        .alert-btn.secondary {
            background: #f0f0f0;
            color: #333;
        }

        .result-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .result-badge.normal {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .result-badge.abnormal {
            background: #ffebee;
            color: #c62828;
        }

        .pattern-list {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .pattern-item {
            padding: 12px;
            border-bottom: 1px solid #f0f0f0;
        }

        .pattern-item:last-child {
            border-bottom: none;
        }

        .pattern-item h5 {
            font-size: 14px;
            color: #333;
            margin-bottom: 4px;
        }

        .pattern-item p {
            font-size: 12px;
            color: #666;
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .loading-overlay.active {
            display: flex;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255,255,255,0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .emulator-container {
                transform: scale(0.9);
            }
            
            .demo-header h1 {
                font-size: 22px;
            }
        }

        .excel-format-selector {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .format-option {
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .format-option:hover {
            border-color: #aa0000;
            background: #fff5f5;
        }

        .format-option.selected {
            border-color: #aa0000;
            background: #fff5f5;
        }

        .format-option h4 {
            font-size: 15px;
            color: #333;
            margin-bottom: 4px;
        }

        .format-option p {
            font-size: 12px;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="demo-header">
        <h1>CEM6 èª¤çµç·šæ¤œå‡ºã‚¢ãƒ—ãƒª</h1>
        <p>ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒ‡ãƒ¢ - ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ãƒ»ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆã§ã®å‹•ä½œç¢ºèª</p>
    </div>

    <div class="device-selector">
        <button class="active" onclick="switchDevice('phone')">ğŸ“± ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³</button>
        <button onclick="switchDevice('tablet')">ğŸ“± ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆ</button>
    </div>

    <div class="emulator-container phone" id="emulator">
        <div class="device-frame phone" id="deviceFrame">
            <div class="status-bar">
                <div class="status-bar-left">
                    <span id="time">12:34</span>
                </div>
                <div class="status-bar-right">
                    <span>ğŸ“¶</span>
                    <span>ğŸ“¡</span>
                    <span>ğŸ”‹</span>
                </div>
            </div>
            
            <div class="app-screen">
                <!-- ãƒ›ãƒ¼ãƒ ç”»é¢ -->
                <div class="screen active" id="homeScreen">
                    <div class="header">
                        <h2>CEM6 èª¤çµç·šæ¤œå‡º</h2>
                        <button class="help-btn" onclick="showHelp()">â“˜</button>
                    </div>
                    <div class="content">
                        <div class="welcome-section">
                            <h3>ã‚ˆã†ã“ã</h3>
                            <p>é›»åŠ›é‡è¨ˆã®è¨ˆå™¨æƒ…å ±å–å¾—ã€èª¤çµç·šåˆ¤å®šã€è¨ˆé‡è©¦é¨“ã‚’è¡Œã„ã¾ã™ã€‚</p>
                        </div>

                        <div class="feature-card" onclick="navigateTo('meterInfo')">
                            <div class="feature-icon" style="background: #2196f3;">â„¹ï¸</div>
                            <div class="feature-text">
                                <h4>è¨ˆå™¨æƒ…å ±å–å¾—</h4>
                                <p>TP-BTçµŒç”±ã§é›»åŠ›é‡è¨ˆã®è©³ç´°æƒ…å ±ã‚’å–å¾—</p>
                            </div>
                            <span class="chevron">â€º</span>
                        </div>

                        <div class="feature-card" onclick="navigateTo('misconnection')">
                            <div class="feature-icon" style="background: #ff9800;">âš ï¸</div>
                            <div class="feature-text">
                                <h4>èª¤çµç·šç¢ºèª</h4>
                                <p>CEM6ã‚·ãƒªãƒ¼ã‚ºã®é…ç·šãƒã‚§ãƒƒã‚¯ãƒ»ç•°å¸¸åˆ¤å®š</p>
                            </div>
                            <span class="chevron">â€º</span>
                        </div>

                        <div class="feature-card" onclick="navigateTo('measurement')">
                            <div class="feature-icon" style="background: #4caf50;">ğŸ“Š</div>
                            <div class="feature-text">
                                <h4>è¨ˆé‡å€¤ç¢ºèª</h4>
                                <p>è¨ˆé‡å€¤ã®è‡ªå‹•å–å¾—ã¨å·®åˆ†è¨ˆç®—</p>
                            </div>
                            <span class="chevron">â€º</span>
                        </div>

                        <div class="info-section">
                            <h4>ä½¿ç”¨å‰ã®ç¢ºèªäº‹é …</h4>
                            <div class="info-item">
                                <span class="info-item-icon">âœ“</span>
                                <p>TP-BTãƒ‡ãƒã‚¤ã‚¹ã¨ãƒšã‚¢ãƒªãƒ³ã‚°æ¸ˆã¿ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„</p>
                            </div>
                            <div class="info-item">
                                <span class="info-item-icon">âœ“</span>
                                <p>Bluetoothé€šä¿¡ãŒæœ‰åŠ¹ã«ãªã£ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„</p>
                            </div>
                            <div class="info-item">
                                <span class="info-item-icon">âœ“</span>
                                <p>é›»åŠ›é‡è¨ˆãŒæ¸¬å®šå¯èƒ½ãªçŠ¶æ…‹ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- è¨ˆå™¨æƒ…å ±å–å¾—ç”»é¢ -->
                <div class="screen" id="meterInfoScreen">
                    <div class="header">
                        <button class="help-btn" onclick="navigateTo('home')">â€¹ æˆ»ã‚‹</button>
                        <h2>è¨ˆå™¨æƒ…å ±å–å¾—</h2>
                        <button class="help-btn" onclick="showHelp()">â“˜</button>
                    </div>
                    <div class="content">
                        <div class="connection-status">
                            <div class="status-indicator" id="meterStatusIndicator"></div>
                            <div class="status-text">
                                <h4 id="meterStatusText">æœªæ¥ç¶š</h4>
                                <p id="meterDeviceName">TP-BTãƒ‡ãƒã‚¤ã‚¹ã«æ¥ç¶šã—ã¦ãã ã•ã„</p>
                            </div>
                        </div>

                        <button class="action-button primary" id="meterConnectBtn" onclick="connectMeterBluetooth()">
                            Bluetoothæ¥ç¶š
                        </button>

                        <button class="action-button secondary" id="meterFetchBtn" onclick="fetchMeterInfo()" disabled>
                            è¨ˆå™¨æƒ…å ±å–å¾—
                        </button>

                        <div id="meterInfoData" style="display: none;">
                            <div class="data-grid">
                                <div class="data-grid-header">åŸºæœ¬æƒ…å ±</div>
                                <div class="data-grid-row">
                                    <div class="data-grid-label">è¨ˆå™¨ID</div>
                                    <div class="data-grid-value">CEM6-001234</div>
                                </div>
                                <div class="data-grid-row">
                                    <div class="data-grid-label">è£½é€ No</div>
                                    <div class="data-grid-value">2024010123456</div>
                                </div>
                                <div class="data-grid-row">
                                    <div class="data-grid-label">å½¢å</div>
                                    <div class="data-grid-value">CEM6-3P3W</div>
                                </div>
                                <div class="data-grid-row">
                                    <div class="data-grid-label">ç›¸ç·šå¼</div>
                                    <div class="data-grid-value">ä¸‰ç›¸3ç·šå¼</div>
                                </div>
                                <div class="data-grid-row">
                                    <div class="data-grid-label">å®šæ ¼é›»åœ§</div>
                                    <div class="data-grid-value">200 V</div>
                                </div>
                                <div class="data-grid-row">
                                    <div class="data-grid-label">å®šæ ¼é›»æµ</div>
                                    <div class="data-grid-value">60 A</div>
                                </div>
                            </div>

                            <div class="data-grid">
                                <div class="data-grid-header">è¨ˆé‡å€¤æƒ…å ±</div>
                                <div class="data-grid-row">
                                    <div class="data-grid-label">æœ‰åŠ¹é›»åŠ›é‡</div>
                                    <div class="data-grid-value">12,345.67 kWh</div>
                                </div>
                                <div class="data-grid-row">
                                    <div class="data-grid-label">ç„¡åŠ¹é›»åŠ›é‡</div>
                                    <div class="data-grid-value">2,345.12 kvarh</div>
                                </div>
                                <div class="data-grid-row">
                                    <div class="data-grid-label">ç¾åœ¨é›»åŠ›</div>
                                    <div class="data-grid-value">3.45 kW</div>
                                </div>
                            </div>

                            <button class="action-button success" onclick="navigateTo('excelExport')">
                                Excelå‡ºåŠ›
                            </button>
                        </div>
                    </div>
                </div>

                <!-- èª¤çµç·šç¢ºèªç”»é¢ -->
                <div class="screen" id="misconnectionScreen">
                    <div class="header">
                        <button class="help-btn" onclick="navigateTo('home')">â€¹ æˆ»ã‚‹</button>
                        <h2>èª¤çµç·šç¢ºèª</h2>
                        <button class="help-btn" onclick="showHelp()">â“˜</button>
                    </div>
                    <div class="content">
                        <div class="connection-status">
                            <div class="status-indicator" id="misconnStatusIndicator"></div>
                            <div class="status-text">
                                <h4 id="misconnStatusText">æœªæ¥ç¶š</h4>
                                <p id="misconnDeviceName">TP-BTãƒ‡ãƒã‚¤ã‚¹ã«æ¥ç¶šã—ã¦ãã ã•ã„</p>
                            </div>
                        </div>

                        <button class="action-button primary" id="misconnConnectBtn" onclick="connectMisconnBluetooth()">
                            Bluetoothæ¥ç¶š
                        </button>

                        <div class="form-group">
                            <label>ç›¸ç·šå¼</label>
                            <select id="phaseWireType">
                                <option value="THREE_PHASE_3_WIRE">ä¸‰ç›¸3ç·šå¼</option>
                                <option value="THREE_PHASE_4_WIRE">ä¸‰ç›¸4ç·šå¼</option>
                                <option value="SINGLE_PHASE_2_WIRE">å˜ç›¸2ç·šå¼</option>
                                <option value="SINGLE_PHASE_3_WIRE">å˜ç›¸3ç·šå¼</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>å®šæ ¼é›»åœ§ (V)</label>
                            <select id="ratedVoltage">
                                <option value="200">200 V</option>
                                <option value="100">100 V</option>
                                <option value="400">400 V</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>æ¥ç¶šæ©Ÿå™¨</label>
                            <select id="connectedDevice">
                                <option value="SIMULATED_LOAD">æ¨¡æ“¬è² è·</option>
                                <option value="WIRING_CHECKER">é…ç·šãƒã‚§ãƒƒã‚¯æ©Ÿ</option>
                            </select>
                        </div>

                        <button class="action-button secondary" id="misconnCheckBtn" onclick="checkMisconnection()" disabled>
                            é…ç·šãƒã‚§ãƒƒã‚¯å®Ÿè¡Œ
                        </button>

                        <div id="misconnectionResult" style="display: none;">
                            <div class="data-grid">
                                <div class="data-grid-header">åˆ¤å®šçµæœ</div>
                                <div class="data-grid-row">
                                    <div class="data-grid-label">ç·åˆåˆ¤å®š</div>
                                    <div class="data-grid-value">
                                        <span class="result-badge normal">æ­£å¸¸</span>
                                    </div>
                                </div>
                                <div class="data-grid-row">
                                    <div class="data-grid-label">æ¤œå‡ºãƒ‘ã‚¿ãƒ¼ãƒ³</div>
                                    <div class="data-grid-value">-</div>
                                </div>
                                <div class="data-grid-row">
                                    <div class="data-grid-label">æ¤œæŸ»æ—¥æ™‚</div>
                                    <div class="data-grid-value" id="checkDateTime"></div>
                                </div>
                            </div>

                            <div class="data-grid">
                                <div class="data-grid-header">æ¸¬å®šå€¤</div>
                                <div class="data-grid-row">
                                    <div class="data-grid-label">P1 æœ‰åŠ¹é›»åŠ›</div>
                                    <div class="data-grid-value">1.23 kW</div>
                                </div>
                                <div class="data-grid-row">
                                    <div class="data-grid-label">P1 ç„¡åŠ¹é›»åŠ›</div>
                                    <div class="data-grid-value">0.45 kvar</div>
                                </div>
                                <div class="data-grid-row">
                                    <div class="data-grid-label">P3 æœ‰åŠ¹é›»åŠ›</div>
                                    <div class="data-grid-value">1.21 kW</div>
                                </div>
                                <div class="data-grid-row">
                                    <div class="data-grid-label">P3 ç„¡åŠ¹é›»åŠ›</div>
                                    <div class="data-grid-value">0.43 kvar</div>
                                </div>
                            </div>

                            <button class="action-button success" onclick="navigateTo('excelExport')">
                                Excelå‡ºåŠ›
                            </button>
                        </div>
                    </div>
                </div>

                <!-- è¨ˆé‡å€¤ç¢ºèªç”»é¢ -->
                <div class="screen" id="measurementScreen">
                    <div class="header">
                        <button class="help-btn" onclick="navigateTo('home')">â€¹ æˆ»ã‚‹</button>
                        <h2>è¨ˆé‡å€¤ç¢ºèª</h2>
                        <button class="help-btn" onclick="showHelp()">â“˜</button>
                    </div>
                    <div class="content">
                        <div class="connection-status">
                            <div class="status-indicator" id="measureStatusIndicator"></div>
                            <div class="status-text">
                                <h4 id="measureStatusText">æœªæ¥ç¶š</h4>
                                <p id="measureDeviceName">TP-BTãƒ‡ãƒã‚¤ã‚¹ã«æ¥ç¶šã—ã¦ãã ã•ã„</p>
                            </div>
                        </div>

                        <button class="action-button primary" id="measureConnectBtn" onclick="connectMeasureBluetooth()">
                            Bluetoothæ¥ç¶š
                        </button>

                        <div class="timer-display">
                            <h3 id="timerDisplay">00:00</h3>
                            <p>è¨ˆé‡è©¦é¨“ã‚¿ã‚¤ãƒãƒ¼</p>
                        </div>

                        <button class="action-button secondary" id="measureStartBtn" onclick="startMeasurement()" disabled>
                            è¨ˆé‡é–‹å§‹
                        </button>

                        <button class="action-button" id="measureStopBtn" onclick="stopMeasurement()" disabled style="background: #f44336; color: white;">
                            è¨ˆé‡åœæ­¢
                        </button>

                        <div id="measurementData" style="display: none;">
                            <div class="data-grid">
                                <div class="data-grid-header">è¨ˆé‡è¨˜éŒ²</div>
                                <div class="data-grid-row">
                                    <div class="data-grid-label">é–‹å§‹å€¤</div>
                                    <div class="data-grid-value">12,345.67 kWh</div>
                                </div>
                                <div class="data-grid-row">
                                    <div class="data-grid-label">çµ‚äº†å€¤</div>
                                    <div class="data-grid-value">12,346.12 kWh</div>
                                </div>
                                <div class="data-grid-row">
                                    <div class="data-grid-label">å·®åˆ†</div>
                                    <div class="data-grid-value" style="color: #aa0000; font-weight: 700;">0.45 kWh</div>
                                </div>
                                <div class="data-grid-row">
                                    <div class="data-grid-label">è¨ˆé‡æ™‚é–“</div>
                                    <div class="data-grid-value" id="measurementTime">0ç§’</div>
                                </div>
                            </div>

                            <button class="action-button success" onclick="navigateTo('excelExport')">
                                Excelå‡ºåŠ›
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Excelå‡ºåŠ›ç”»é¢ -->
                <div class="screen" id="excelExportScreen">
                    <div class="header">
                        <button class="help-btn" onclick="navigateTo('home')">â€¹ æˆ»ã‚‹</button>
                        <h2>Excelå‡ºåŠ›</h2>
                        <button class="help-btn" onclick="showHelp()">â“˜</button>
                    </div>
                    <div class="content">
                        <div class="excel-format-selector">
                            <h4 style="margin-bottom: 15px; color: #333;">å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆé¸æŠ</h4>
                            
                            <div class="format-option selected" onclick="selectFormat('A')">
                                <h4>ğŸ“„ ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆA (ãã‚“ã§ã‚“ç¤¾ç”¨)</h4>
                                <p>è¨ˆé‡å¯¾è±¡åã€éšã€è¨­ç½®å ´æ‰€ç­‰ã®è©³ç´°æƒ…å ±ã‚’å«ã‚€</p>
                            </div>

                            <div class="format-option" onclick="selectFormat('B')">
                                <h4>ğŸ“„ ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆB (å¤§å´æ¨™æº–)</h4>
                                <p>æ¨™æº–çš„ãªè¨ˆå™¨æƒ…å ±ãƒ»åˆ¤å®šçµæœ</p>
                            </div>

                            <div class="format-option" onclick="selectFormat('C')">
                                <h4>ğŸ“„ ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆC (ã‚¹ãƒ‘ã‚¤ãƒ€ãƒ¼ãƒ—ãƒ©ã‚¹é€£æº)</h4>
                                <p>å¤–éƒ¨ã‚·ã‚¹ãƒ†ãƒ é€£æºç”¨ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ</p>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>è¨ˆé‡å¯¾è±¡åï¼ˆä»»æ„ï¼‰</label>
                            <input type="text" placeholder="ä¾‹: Aæ£Ÿ3éš" id="targetName">
                        </div>

                        <div class="form-group">
                            <label>è¨­ç½®å ´æ‰€ï¼ˆä»»æ„ï¼‰</label>
                            <input type="text" placeholder="ä¾‹: é›»æ°—å®¤" id="location">
                        </div>

                        <div class="form-group">
                            <label>å‚™è€ƒï¼ˆä»»æ„ï¼‰</label>
                            <input type="text" placeholder="ä¾‹: å®šæœŸç‚¹æ¤œ" id="remarks">
                        </div>

                        <button class="action-button success" onclick="exportExcel()">
                            Excelãƒ•ã‚¡ã‚¤ãƒ«å‡ºåŠ›
                        </button>

                        <div class="info-section" style="margin-top: 15px;">
                            <h4>å‡ºåŠ›æƒ…å ±</h4>
                            <div class="info-item">
                                <span class="info-item-icon">âœ“</span>
                                <p>ãƒ•ã‚¡ã‚¤ãƒ«ã¯Downloadsãƒ•ã‚©ãƒ«ãƒ€ã«ä¿å­˜ã•ã‚Œã¾ã™</p>
                            </div>
                            <div class="info-item">
                                <span class="info-item-icon">âœ“</span>
                                <p>ãƒ•ã‚¡ã‚¤ãƒ«å: CEM6_èª¤çµç·šæ¤œå‡º_YYYYMMDD_HHMMSS.xlsx</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
    </div>

    <script>
        // çŠ¶æ…‹ç®¡ç†
        let currentDevice = 'phone';
        let meterConnected = false;
        let misconnConnected = false;
        let measureConnected = false;
        let measurementTimer = null;
        let measurementSeconds = 0;
        let selectedFormat = 'A';

        // æ™‚è¨ˆæ›´æ–°
        function updateTime() {
            const now = new Date();
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            document.getElementById('time').textContent = `${hours}:${minutes}`;
        }
        setInterval(updateTime, 1000);
        updateTime();

        // ãƒ‡ãƒã‚¤ã‚¹åˆ‡æ›¿
        function switchDevice(device) {
            currentDevice = device;
            const emulator = document.getElementById('emulator');
            const frame = document.getElementById('deviceFrame');
            const buttons = document.querySelectorAll('.device-selector button');
            
            buttons.forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            if (device === 'phone') {
                emulator.className = 'emulator-container phone';
                frame.className = 'device-frame phone';
            } else {
                emulator.className = 'emulator-container tablet';
                frame.className = 'device-frame tablet';
            }
        }

        // ç”»é¢é·ç§»
        function navigateTo(screenName) {
            const screens = document.querySelectorAll('.screen');
            screens.forEach(s => s.classList.remove('active'));
            
            const targetScreen = document.getElementById(screenName + 'Screen');
            if (targetScreen) {
                targetScreen.classList.add('active');
            }
        }

        // ãƒ˜ãƒ«ãƒ—è¡¨ç¤º
        function showHelp() {
            alert('CEM6 èª¤çµç·šæ¤œå‡ºã‚¢ãƒ—ãƒª\nãƒãƒ¼ã‚¸ãƒ§ãƒ³: 1.0.0\n\nÂ© 2025 å¤§å´é›»æ°—å·¥æ¥­æ ªå¼ä¼šç¤¾\nã‚¤ãƒ³ã‚­ãƒ¥ãƒ™ãƒ¼ã‚·ãƒ§ãƒ³å®¤\n\nã“ã‚Œã¯ãƒ‡ãƒ¢ã‚µã‚¤ãƒˆã§ã™ã€‚å®Ÿéš›ã®Bluetoothé€šä¿¡ã¯è¡Œã„ã¾ã›ã‚“ã€‚');
        }

        // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º
        function showLoading() {
            document.getElementById('loadingOverlay').classList.add('active');
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').classList.remove('active');
        }

        // è¨ˆå™¨æƒ…å ± - Bluetoothæ¥ç¶š
        async function connectMeterBluetooth() {
            showLoading();
            document.getElementById('meterStatusIndicator').className = 'status-indicator connecting';
            document.getElementById('meterStatusText').textContent = 'æ¥ç¶šä¸­...';
            
            await new Promise(resolve => setTimeout(resolve, 2000));
            
            meterConnected = true;
            document.getElementById('meterStatusIndicator').className = 'status-indicator connected';
            document.getElementById('meterStatusText').textContent = 'æ¥ç¶šæ¸ˆã¿';
            document.getElementById('meterDeviceName').textContent = 'TP-BT-12345';
            document.getElementById('meterConnectBtn').disabled = true;
            document.getElementById('meterFetchBtn').disabled = false;
            
            hideLoading();
            alert('æ¥ç¶šæˆåŠŸ\n\nTP-BT-12345 ã«æ¥ç¶šã—ã¾ã—ãŸã€‚');
        }

        // è¨ˆå™¨æƒ…å ±å–å¾—
        async function fetchMeterInfo() {
            showLoading();
            await new Promise(resolve => setTimeout(resolve, 1500));
            
            document.getElementById('meterInfoData').style.display = 'block';
            hideLoading();
            alert('å–å¾—æˆåŠŸ\n\nè¨ˆå™¨æƒ…å ±ã‚’å–å¾—ã—ã¾ã—ãŸã€‚');
        }

        // èª¤çµç·š - Bluetoothæ¥ç¶š
        async function connectMisconnBluetooth() {
            showLoading();
            document.getElementById('misconnStatusIndicator').className = 'status-indicator connecting';
            document.getElementById('misconnStatusText').textContent = 'æ¥ç¶šä¸­...';
            
            await new Promise(resolve => setTimeout(resolve, 2000));
            
            misconnConnected = true;
            document.getElementById('misconnStatusIndicator').className = 'status-indicator connected';
            document.getElementById('misconnStatusText').textContent = 'æ¥ç¶šæ¸ˆã¿';
            document.getElementById('misconnDeviceName').textContent = 'TP-BT-12345';
            document.getElementById('misconnConnectBtn').disabled = true;
            document.getElementById('misconnCheckBtn').disabled = false;
            
            hideLoading();
            alert('æ¥ç¶šæˆåŠŸ\n\nTP-BT-12345 ã«æ¥ç¶šã—ã¾ã—ãŸã€‚');
        }

        // èª¤çµç·šãƒã‚§ãƒƒã‚¯
        async function checkMisconnection() {
            showLoading();
            await new Promise(resolve => setTimeout(resolve, 2500));
            
            const now = new Date();
            document.getElementById('checkDateTime').textContent = 
                `${now.getFullYear()}/${String(now.getMonth() + 1).padStart(2, '0')}/${String(now.getDate()).padStart(2, '0')} ${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
            
            document.getElementById('misconnectionResult').style.display = 'block';
            hideLoading();
            alert('ãƒã‚§ãƒƒã‚¯å®Œäº†\n\né…ç·šãƒã‚§ãƒƒã‚¯ãŒå®Œäº†ã—ã¾ã—ãŸã€‚\nåˆ¤å®šçµæœ: æ­£å¸¸');
        }

        // è¨ˆé‡å€¤ - Bluetoothæ¥ç¶š
        async function connectMeasureBluetooth() {
            showLoading();
            document.getElementById('measureStatusIndicator').className = 'status-indicator connecting';
            document.getElementById('measureStatusText').textContent = 'æ¥ç¶šä¸­...';
            
            await new Promise(resolve => setTimeout(resolve, 2000));
            
            measureConnected = true;
            document.getElementById('measureStatusIndicator').className = 'status-indicator connected';
            document.getElementById('measureStatusText').textContent = 'æ¥ç¶šæ¸ˆã¿';
            document.getElementById('measureDeviceName').textContent = 'TP-BT-12345';
            document.getElementById('measureConnectBtn').disabled = true;
            document.getElementById('measureStartBtn').disabled = false;
            
            hideLoading();
            alert('æ¥ç¶šæˆåŠŸ\n\nTP-BT-12345 ã«æ¥ç¶šã—ã¾ã—ãŸã€‚');
        }

        // è¨ˆé‡é–‹å§‹
        function startMeasurement() {
            measurementSeconds = 0;
            document.getElementById('measureStartBtn').disabled = true;
            document.getElementById('measureStopBtn').disabled = false;
            
            measurementTimer = setInterval(() => {
                measurementSeconds++;
                const minutes = Math.floor(measurementSeconds / 60);
                const seconds = measurementSeconds % 60;
                document.getElementById('timerDisplay').textContent = 
                    `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            }, 1000);
        }

        // è¨ˆé‡åœæ­¢
        function stopMeasurement() {
            clearInterval(measurementTimer);
            document.getElementById('measureStartBtn').disabled = false;
            document.getElementById('measureStopBtn').disabled = true;
            document.getElementById('measurementTime').textContent = `${measurementSeconds}ç§’`;
            document.getElementById('measurementData').style.display = 'block';
            
            alert('è¨ˆé‡å®Œäº†\n\nè¨ˆé‡ãƒ‡ãƒ¼ã‚¿ã‚’è¨˜éŒ²ã—ã¾ã—ãŸã€‚');
        }

        // ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆé¸æŠ
        function selectFormat(format) {
            selectedFormat = format;
            const options = document.querySelectorAll('.format-option');
            options.forEach((opt, index) => {
                opt.classList.remove('selected');
                if ((format === 'A' && index === 0) || 
                    (format === 'B' && index === 1) || 
                    (format === 'C' && index === 2)) {
                    opt.classList.add('selected');
                }
            });
        }

        // Excelå‡ºåŠ›
        async function exportExcel() {
            const targetName = document.getElementById('targetName').value;
            const location = document.getElementById('location').value;
            const remarks = document.getElementById('remarks').value;
            
            showLoading();
            await new Promise(resolve => setTimeout(resolve, 1500));
            hideLoading();
            
            const now = new Date();
            const fileName = `CEM6_èª¤çµç·šæ¤œå‡º_${now.getFullYear()}${String(now.getMonth() + 1).padStart(2, '0')}${String(now.getDate()).padStart(2, '0')}_${String(now.getHours()).padStart(2, '0')}${String(now.getMinutes()).padStart(2, '0')}${String(now.getSeconds()).padStart(2, '0')}.xlsx`;
            
            alert(`Excelå‡ºåŠ›å®Œäº†\n\nãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ: ${selectedFormat}\nãƒ•ã‚¡ã‚¤ãƒ«å: ${fileName}\n\nDownloadsãƒ•ã‚©ãƒ«ãƒ€ã«ä¿å­˜ã•ã‚Œã¾ã—ãŸã€‚\n\nâ€»ãƒ‡ãƒ¢ã‚µã‚¤ãƒˆã®ãŸã‚å®Ÿéš›ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯ç”Ÿæˆã•ã‚Œã¾ã›ã‚“ã€‚`);
        }
    </script>
</body>
</html>
